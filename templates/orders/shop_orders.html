<!DOCTYPE html>
<html>
<head>
    <title>–ú–µ–Ω—ñ“£ –¥“Ø–∫–µ–Ω—ñ–º–µ –∫–µ–ª—ñ–ø —Ç“Ø—Å–∫–µ–Ω —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä</title>
</head>
<body>
    <h2>–î“Ø–∫–µ–Ω –∏–µ—Å—ñ –ø–∞–Ω–µ–ª—ñ</h2>

    <table border="1">
        <tr>
            <th>–¢–∞—É–∞—Ä</th>
            <th>–ö–ª–∏–µ–Ω—Ç</th>
            <th>–ú–µ–∫–µ–Ω–∂–∞–π</th>
            <th>–°–∞–Ω—ã</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–ö“Ø–Ω—ñ</th>
            <th>”®“£–¥–µ—É</th>
        </tr>
        {% for order in orders %}
        <tr>
            <td>{{ order.product.name }}</td>
            <td>{{ order.customer_name }}</td>
            <td>{{ order.address }}</td>
            <td>{{ order.quantity }}</td>
            <td>{{ order.status }}</td>
            <td>{{ order.created_at|date:"d.m.Y H:i" }}</td>
            <td>
                <form method="post" action="{% url 'update_order_status' order.id %}">
                    {% csrf_token %}
                    <select name="status">
                        <option value="new" {% if order.status == 'new' %}selected{% endif %}>–ñ–∞“£–∞</option>
                        <option value="processing" {% if order.status == 'processing' %}selected{% endif %}>“ö–∞–±—ã–ª–¥–∞–Ω–¥—ã</option>
                        <option value="delivering" {% if order.status == 'delivering' %}selected{% endif %}>–ñ–æ–ª–¥–∞</option>
                        <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>–ñ–µ—Ç–∫—ñ–∑—ñ–ª–¥—ñ</option>
                    </select>
                    <button type="submit">–°–∞“õ—Ç–∞—É</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>

    <!-- üîä –î—ã–±—ã—Å –æ–π–Ω–∞—Ç—É —Ç–µ–≥—ñ -->
    <audio id="notif-sound" src="/static/sound/new_order.mp3" preload="auto"></audio>

    <!-- üîÅ 5 —Å–µ–∫ —Å–∞–π—ã–Ω –∂–∞“£–∞ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç—ã —Ç–µ–∫—Å–µ—Ä—É -->
    <script>
        function checkNewOrdersShop() {
            fetch("{% url 'check_new_orders_shop' %}")
                .then(response => response.json())
                .then(data => {
                    if (data.new_order) {
                        document.getElementById('notif-sound').play();
                    }
                });
        }

        setInterval(checkNewOrdersShop, 5000); // ”ô—Ä 5 —Å–µ–∫ —Å–∞–π—ã–Ω —Ç–µ–∫—Å–µ—Ä—É
    </script>
</body>
</html>
